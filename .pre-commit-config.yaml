# Pre-commit: https://pre-commit.com
# Install: just init && just install-hooks
# Run manually: pre-commit run --all-files
# Conventional commits are validated on commit-msg (see commit-msg hook).
# Hooks run in order: Ruff (lint --fix + format) on tooling Python, then QA (lint + format-check + tests).

default_install_hook_types: [pre-commit, commit-msg]

repos:
  - repo: https://github.com/compilerla/conventional-pre-commit
    rev: v1.3.0
    hooks:
      - id: conventional-pre-commit
        stages: [commit-msg]

  - repo: local
    hooks:
      # Use project Ruff so we always commit linted/formatted tooling code (same as just lint + just format).
      - id: ruff
        name: Ruff (lint --fix + format)
        entry: bash -c 'tooling/.venv/bin/ruff check tooling/ --fix && tooling/.venv/bin/ruff format tooling/'
        language: system
        pass_filenames: false
        files: ^tooling/.*\.py$

      - id: qa
        name: Tooling QA (lint, format-check, tests)
        entry: just qa
        language: system
        pass_filenames: false

      - id: check-empty-print-statements
        name: Check for empty print statements to stderr/stdout
        entry: bash
        args: [
          -c,
          'if grep -rn ''print("", file=sys\.\(stderr\|stdout\)'' tooling/src/ tooling/tests/ 2>/dev/null; then echo "Error: Empty print statements to stderr/stdout are forbidden. Provide descriptive error messages."; exit 1; fi'
        ]
        language: system
        pass_filenames: false
