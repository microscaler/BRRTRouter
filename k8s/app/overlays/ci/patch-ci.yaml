# CI settings patch for automated testing
# Minimal logging, no backtraces, optimized for performance testing
# Increased resources for GitHub Actions (4 cores, 16GB RAM available)
apiVersion: apps/v1
kind: Deployment
metadata:
  name: petstore
  namespace: brrtrouter-dev
spec:
  template:
    spec:
      containers:
        - name: petstore
          env:
            # Production-like logging - only warnings and errors
            - name: RUST_LOG
              value: "warn,brrtrouter=info,may=warn,may_minihttp=warn"
            # Disable backtraces for performance
            - name: RUST_BACKTRACE
              value: "0"
            # JSON logs for structured parsing
            - name: BRRTR_LOG_FORMAT
              value: "json"
            # Sampled logging for performance
            - name: BRRTR_LOG_SAMPLING_MODE
              value: "sampled"
            # Sync logging (simpler for CI)
            - name: BRRTR_LOG_ASYNC
              value: "false"
            # No source locations (smaller logs)
            - name: BRRTR_LOG_INCLUDE_LOCATION
              value: "false"
            # Info level (not debug)
            - name: BRRTR_LOG_LEVEL
              value: "info"
          resources:
            # Increased resources for GitHub Actions CI environment
            # GitHub Actions provides: 4 cores, 16GB RAM
            # We use more memory to prevent OOM kills during load tests
            requests:
              memory: "4Gi"    # Increased from 1Gi (was too low for load tests)
              cpu: "3000m"     # Increased from 1000m (1.5 cores for better performance)
            limits:
              memory: "6Gi"    # Increased from 2Gi (balanced: leaves room for other services)
              cpu: "4000m"    # Keep at 4 cores (all available)

