<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  
  mermaid.initialize({ 
    startOnLoad: false,
    theme: 'default',
    securityLevel: 'loose',
  });

  // Wait for DOM to be ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', renderMermaidDiagrams);
  } else {
    renderMermaidDiagrams();
  }

  function renderMermaidDiagrams() {
    // Find all code blocks with language-mermaid class
    const mermaidBlocks = document.querySelectorAll('pre.language-mermaid > code');
    
    mermaidBlocks.forEach((block, index) => {
      // Get the mermaid code
      const code = block.textContent;
      
      // Create a new div to hold the rendered diagram
      const div = document.createElement('div');
      div.className = 'mermaid';
      div.textContent = code;
      div.id = `mermaid-diagram-${index}`;
      
      // Replace the pre/code block with the div
      const pre = block.parentElement;
      pre.parentElement.replaceChild(div, pre);
    });
    
    // Render all mermaid diagrams
    mermaid.run({
      querySelector: '.mermaid'
    });
  }
</script>
<style>
  /* Style for mermaid diagrams */
  .mermaid {
    background-color: white;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 20px;
    margin: 20px 0;
    overflow-x: auto;
    /* Make diagrams 200% wider - break out of content container */
    width: 200%;
    max-width: 200%;
    position: relative;
    left: 50%;
    transform: translateX(-50%);
  }
  
  .mermaid svg {
    width: 100%;
    height: auto;
  }
</style>

